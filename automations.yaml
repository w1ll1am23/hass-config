##########################################
###############Time Automations################
##########################################

  - alias: reboot camera for calibration
    trigger:
      - platform: time
        at: '00:01:00'
    action:
      - service: homeassistant.turn_on
        entity_id: switch.camera_reboot

  - alias: dim bathroom lights at night
    trigger:
      - platform: state
        entity_id: binary_sensor.bathroom_door_opened
        to: 'off'
    condition:
      condition: or
      conditions:
        - condition: time
          after: '21:30:00'
        - condition: time
          before: '06:00:00'
    action:
      service: homeassistant.turn_on
      entity_id: script.dim_bathroom_lights


  - alias: close garage if open for more than 15 minutes
    trigger:
      - platform: state
        entity_id: cover.garage_door
        to: 'open'
        for:
          minutes: 15
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: input_boolean.on_vacation
          state: 'off'
    action:
      service: cover.close_cover
      entity_id: cover.garage_door

  - alias: notify garage is open for more than 15 minutes
    trigger:
      - platform: state
        entity_id: cover.garage_door
        to: 'open'
        for:
          minutes: 15
    action:
      - service: notify.sms_billy
        data:
          message: >
            Garage is open!


  - alias: office lights off after 5 minutes during work week in morning
    trigger:
      - platform: state
        entity_id: group.office_lights
        to: 'on'
        for:
          minutes: 5
    condition:
      condition: and
      conditions:
        - condition: time
          after: '06:00:00'
        - condition: time
          before: '09:30:00'
        - condition: state
          entity_id: binary_sensor.workday_sensor
          state: 'on'
        - condition: state
          entity_id: device_tracker.w1ll1am_a0001
          state: 'not_home'
        - condition: state
          entity_id: device_tracker.melinas_iphone
          state: 'not_home'
    action:
      - service: homeassistant.turn_off
        entity_id: light.office_lamp
      - service: homeassistant.turn_off
        entity_id: switch.power_strip

  - alias: garage light off after 30 minutes
    trigger:
      - platform: state
        entity_id: group.garage_lights
        to: 'on'
        for:
          minutes: 30
    action:
      service: homeassistant.turn_off
      entity_id: group.garage_lights

  - alias: closet light off after 10 minutes
    trigger:
      - platform: state
        entity_id: light.closet
        to: 'on'
        for:
          minutes: 10
    action:
      service: homeassistant.turn_off
      entity_id: light.closet

  - alias: turn outside lights off
    trigger:
      - platform: sun
        event: sunrise
      - platform: time
        hours: 22
        minutes: 30
        seconds: 0
      - platform: event
        event_type: toggle_outside_lights
    action:
      service: homeassistant.turn_off
      entity_id: switch.outside_lights

  - alias: turn on living room lamp at dusk
    trigger:
      - platform: template
        value_template: '{{ states.sun.sun.attributes.elevation < 4.0 }}'
    condition:
        condition: or
        conditions:
          - condition: state
            entity_id: device_tracker.w1ll1am_a0001
            state: home
          - condition: state
            entity_id: device_tracker.melinas_iphone
            state: home
    action:
      service: homeassistant.turn_on
      entity_id: light.shelf_lamp


##########################################
##############Sensor Automations###############
##########################################

  - alias: turn living room tv off
    trigger:
      platform: state
      entity_id: media_player.living_room
      to: 'off'
      for:
        minutes: 15
    condition:
      condition: and
      conditions:
          - condition: state
            entity_id: binary_sensor.living_room_tv
            state: 'on'
    action:
      service: homeassistant.turn_off
      entity_id: switch.living_room_tv_power

  - alias: bathroom door opened bedtime
    trigger:
      - platform: state
        entity_id: binary_sensor.bathroom_door_opened
        from: 'off'
        to: 'on'
    condition:
      condition: and
      conditions:
        - condition: time
          after: '21:30:00'
        - condition: time
          before: '22:30:00'
        - condition: state
          entity_id: light.bathroom_light
          state: 'off'
    action:
      service: light.turn_on
      entity_id: light.bathroom_light
      data:
        brightness: 25

  - alias: bathroom door opened at morning
    trigger:
      - platform: state
        entity_id: binary_sensor.bathroom_door_opened
        from: 'off'
        to: 'on'
    condition:
      condition: or
      conditions:
        - condition: time
          before: '06:00:00'
        - condition: time
          after: '22:30:00'
        - condition: state
          entity_id: light.bathroom_light
          state: 'off'
    action:
      service: light.turn_on
      entity_id: light.bathroom_light_1
      data:
        brightness: 10

  - alias: bathroom door opened
    trigger:
      - platform: state
        entity_id: binary_sensor.bathroom_door_opened
        from: 'off'
        to: 'on'
    condition:
      condition: and
      conditions:
        - condition: time
          after: '06:00:00'
        - condition: time
          before: '22:30:00'
        - condition: state
          entity_id: light.bathroom_light
          state: 'off'
    action:
      service: light.turn_on
      entity_id: light.bathroom_light
      data:
        brightness: 255

  - alias: turn office lights on when motion detected
    trigger:
      - platform: state
        entity_id: binary_sensor.office_motion
        from: 'off'
        to: 'on'
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: group.office_lights
          state: 'off'
        - condition: state
          entity_id: binary_sensor.up_stairs_hallway_motion
          state: 'on'
    action:
      - service: homeassistant.turn_on
        entity_id: switch.power_strip
      - service: homeassistant.turn_on
        entity_id: light.office_lamp

  - alias: hallway motion at night
    trigger:
      - platform: state
        entity_id: binary_sensor.up_stairs_hallway_motion
        from: 'off'
        to: 'on'
    condition:
      condition: and
      conditions:
        - condition: time
          after: '20:00:00'
        - condition: time
          before: '22:30:00'
        - condition: state
          entity_id: group.bedroom_lights
          state: 'off'
    action:
      service: homeassistant.turn_on
      entity_id: light.bedroom_lamp

  - alias: dining room fan on
    trigger:
      platform: state
      entity_id: binary_sensor.wink_relays_bottom_button
      from: 'off'
      to: 'on'
    condition:
      condition: state
      entity_id: fan.dining_room_fan
      state: 'off'
    action:
      - service: homeassistant.turn_on
        entity_id: fan.dining_room_fan

  - alias: dining room fan off
    trigger:
      platform: state
      entity_id: binary_sensor.wink_relays_bottom_button
      from: 'off'
      to: 'on'
    condition:
      condition: state
      entity_id: fan.dining_room_fan
      state: 'on'
    action:
      - service: homeassistant.turn_off
        entity_id: fan.dining_room_fan

  - alias: dining room fan light on
    trigger:
      platform: state
      entity_id: binary_sensor.wink_relays_top_button
      from: 'off'
      to: 'on'
    condition:
      condition: state
      entity_id: light.dining_room_fan_light
      state: 'off'
    action:
      - service: homeassistant.turn_on
        entity_id: light.dining_room_fan_light

  - alias: dining room fan light off
    trigger:
      platform: state
      entity_id: binary_sensor.wink_relays_top_button
      from: 'off'
      to: 'on'
    condition:
      condition: state
      entity_id: light.dining_room_fan_light
      state: 'on'
    action:
      - service: homeassistant.turn_off
        entity_id: light.dining_room_fan_light

  - alias: office lights on remote
    trigger:
      platform: template
      value_template: "{{ is_state_attr('binary_sensor.remote', 'button_on_pressed', True)}}"
    action:
      - service: homeassistant.turn_on
        entity_id: light.office_lamp
      - service: homeassistant.turn_on
        entity_id: switch.power_strip

  - alias: office lights off remote
    trigger:
      platform: template
      value_template: "{{ is_state_attr('binary_sensor.remote', 'button_off_pressed', True)}}"
    action:
      - service: homeassistant.turn_off
        entity_id: light.office_lamp
      - service: homeassistant.turn_off
        entity_id: switch.power_strip

  - alias: dryer started
    trigger:
      platform: state
      entity_id: binary_sensor.spotter_vibration
      to: 'on'
      for:
        minutes: 3
    action:
      service: homeassistant.turn_on
      entity_id: input_boolean.dryer_switch

  - alias: dryer done
    trigger:
      - platform: state
        entity_id: binary_sensor.spotter_vibration
        to: 'off'
        for:
          minutes: 2
    condition:
      condition: state
      entity_id: input_boolean.dryer_switch
      state: 'on'
    action:
      - service: homeassistant.turn_off
        entity_id: input_boolean.dryer_switch
      - service: notify.sms_billy
        data:
          message: >
            Dryer is done!

  - alias: notify of dishwasher leak
    trigger:
      - platform: state
        entity_id: binary_sensor.dishwasher_liquid_detected
        to: 'on'
    action:
      - service: notify.sms_billy
        data:
          message: >
            The dishwasher is leaking!!!

  - alias: power is out
    trigger:
      - platform: state
        entity_id: binary_sensor.ups_online_status
        to: 'off'
    action:
      - service: notify.sms_billy
        data:
          message: >
            Power is out, running on battery.

  - alias: power back on
    trigger:
      - platform: state
        entity_id: binary_sensor.ups_online_status
        from: 'off'
        to: 'on'
    action:
      - service: notify.sms_billy
        data:
          message: >
            Power is back on!

  - alias: turn on office ac
    trigger:
      - platform: state
        entity_id: binary_sensor.office_temp_high_threshold
        to: 'on'
        for:
          minutes: 20
    action:
      service: homeassistant.turn_on
      entity_id: switch.office_air_conditioner

  - alias: turn off office ac
    trigger:
      - platform: state
        entity_id: binary_sensor.office_temp_low_threshold
        to: 'on'
        for:
          minutes: 20
    action:
      service: homeassistant.turn_off
      entity_id: switch.office_air_conditioner

  - alias: check freezer
    trigger:
      - platform: state
        entity_id: binary_sensor.freezer_temp_threshold
        to: 'on'
        for:
          minutes: 15
    action:
      - service: notify.sms_billy
        data:
          message: >
            Check the freezer! {{ states('sensor.garage_freezer_temperature') }}

  - alias: laundry light on when door opens
    trigger:
      - platform: state
        entity_id: binary_sensor.laundry_door_opened
        from: 'off'
        to: 'on'
    action:
      service: homeassistant.turn_on
      entity_id: light.laundry

  - alias: outside lights on when door opens
    trigger:
      - platform: state
        entity_id: binary_sensor.front_door_opened
        from: 'off'
        to: 'on'
    condition:
      - condition: template
        value_template: '{{ states.sun.sun.attributes.elevation < 1.0 }}'
    action:
      service: homeassistant.turn_on
      entity_id: switch.outside_lights

  - alias: laundry light off when door closes
    trigger:
      - platform: state
        entity_id: binary_sensor.laundry_door_opened
        to: 'off'
    action:
      service: homeassistant.turn_off
      entity_id: light.laundry

  - alias: printing done
    trigger:
      - platform: state
        entity_id: binary_sensor.octoprint_printing
        from: "on"
        to: "off"
    action:
      service: notify.sms_billy
      data:
        message: 'Printing done!'

  - alias: office lights on when door opens
    trigger:
      - platform: state
        entity_id: binary_sensor.office_door_opened
        from: 'off'
        to: 'on'
    action:
      - service: light.turn_on
        entity_id: light.office_lamp
      - service: homeassistant.turn_on
        entity_id: switch.power_strip

  - alias: bedroom lights on when door opens
    trigger:
      - platform: state
        entity_id: binary_sensor.bedroom_door_opened
        from: 'off'
        to: 'on'
    action:
      service: homeassistant.turn_on
      entity_id: group.bedroom_lights

  - alias: lock front door when door closed
    trigger:
      - platform: state
        entity_id: binary_sensor.front_door_opened
        to: 'off'
    action:
      service: homeassistant.turn_on
      entity_id: script.lock_the_door

  - alias: garage light on if door open
    trigger:
      - platform: state
        entity_id: binary_sensor.garage_entry_door_opened
        to: 'on'
    condition:
      - condition: template
        value_template: '{{ states.sun.sun.attributes.elevation < 4.0 }}'
    action:
      service: homeassistant.turn_on
      entity_id: group.garage_lights

  - alias: enable downstairs hall light delayed off script
    trigger:
      - platform: state
        entity_id: light.down_stairs_hallway
        to: 'on'
    action:
      service: homeassistant.turn_on
      entity_id: script.hall_light

  - alias: under bed light on if up in morning
    trigger:
      - platform: state
        entity_id: binary_sensor.bedroom_motion
        to: 'on'
      - platform: state
        entity_id: binary_sensor.bedroom_motion_2
        to: 'on'
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: group.bedroom_lights
          state: 'off'
        - condition: time
          before: '07:00:00'
    action:
      service: homeassistant.turn_on
      entity_id: script.under_bed_light

  - alias: under bed light on if up at night
    trigger:
      - platform: state
        entity_id: binary_sensor.bedroom_motion
        to: 'on'
      - platform: state
        entity_id: binary_sensor.bedroom_motion_2
        to: 'on'
    condition:
      condition: and
      conditions:
        - condition: time
          after: '22:00:00'
        - condition: state
          entity_id: group.bedroom_lights
          state: 'off'
    action:
      service: homeassistant.turn_on
      entity_id: script.under_bed_light

  - alias: notify turtle tank water is too cold
    trigger:
      - platform: numeric_state
        entity_id: sensor.tank_water
        below: 23
    action:
      - service: notify.sms_billy
        data:
          message: >
            Tank water too cold! {{ states('sensor.tank_water') }}

  - alias: notify turtle tank bulb has burned out
    trigger:
      - platform: state
        entity_id: binary_sensor.tank_basking_threshold
        to: 'on'
        for:
          minutes: 45
    action:
      - service: notify.sms_billy
        data:
          message: >
            Check basking bulbs! {{ states('sensor.turtle_tank_basking') }}

  - alias: notify uvb bulb needs changed
    trigger:
      - platform: numeric_state
        entity_id: sensor.tank_uvb
        below: 10
    action:
      service: notify.sms_billy
      data:
        message: >
          UVB output too low! Replace bulb {{ states('sensor.tank_uvb') }}

  - alias: notify that billy unlocked the door
    trigger:
      - platform: state
        entity_id: binary_sensor.billy
        to: 'on'
    condition:
      - condition: state
        entity_id: lock.front_door
        state: locked
        for:
          minutes: 15
    action:
      - service: notify.ios_melinas_iphone
        data:
          message: 'Billy unlocked the door'

  - alias: melina unlocked the door
    trigger:
      - platform: state
        entity_id: binary_sensor.melina
        to: 'on'
    condition:
      - condition: state
        entity_id: lock.front_door
        state: locked
        for:
          minutes: 15
    action:
      - service: notify.sms_billy
        data:
          message: 'Melina unlocked the door'

  - alias: notify that gdottie unlocked the door
    trigger:
      - platform: state
        entity_id: binary_sensor.gdottie
        to: 'on'
    action:
      - service: notify.sms_billy
        data:
          message: 'Grandma unlocked the door'
      - service: notify.ios_melinas_iphone
        data:
          message: 'Grandma unlocked the door'

  - alias: notify that mother unlocked the door
    trigger:
      - platform: state
        entity_id: binary_sensor.parents
        to: 'on'
    action:
      - service: notify.sms_billy
        data:
          message: 'Mother unlocked the door'

##########################################
##############Tasker Automations################
##########################################

  - alias: trigger good night script when phone is plugged in
    trigger:
      - platform: event
        event_type: good_night
    action:
      - service: light.turn_on
        entity_id: light.melinas_nightstand
      - service: homeassistant.turn_on
        entity_id: script.good_night

  - alias: notify that door is open
    trigger:
      - platform: event
        event_type: good_night
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: group.external_doors
          state: 'on'
    action:
      - service: notify.sms_billy
        data:
          message: 'There is a door open.'
      - service: notify.sms_billy
        data:
          message: 'There is a door open.'

  - alias: trigger good morning script when phone is unplugged
    trigger:
      - platform: event
        event_type: good_morning
    action:
      service: homeassistant.turn_on
      entity_id: script.good_morning

##########################################
##############Dasher Automations################
##########################################

  - alias: kitchen sink off
    trigger:
      - platform: event
        event_type: toggle_kitchen_sink_light
    condition:
      - condition: state
        entity_id: light.kitchen_sink_light
        state: 'on'
    action:
      service: homeassistant.turn_off
      entity_id: light.kitchen_sink_light

  - alias: kitchen sink on
    trigger:
      - platform: event
        event_type: toggle_kitchen_sink_light
    condition:
      - condition: state
        entity_id: light.kitchen_sink_light
        state: 'off'
    action:
      service: homeassistant.turn_on
      entity_id: light.kitchen_sink_light

  - alias: downstairs hallway off
    trigger:
      - platform: event
        event_type: toggle_hallway_light
      - platform: event
        event_type: hallway_off
    condition:
      - condition: state
        entity_id: switch.hallway_ceiling_fan_light
        state: 'on'
    action:
      service: homeassistant.turn_off
      entity_id: switch.hallway_ceiling_fan_light

  - alias: outside off
    trigger:
      - platform: event
        event_type: toggle_outside_lights
      - platform: event
        event_type: outside_off
    condition:
      - condition: state
        entity_id: group.entryway
        state: 'on'
    action:
      service: homeassistant.turn_off
      entity_id: group.entryway

  - alias: outside on
    trigger:
      - platform: event
        event_type: toggle_outside_lights
      - platform: event
        event_type: outside_on
    condition:
      - condition: state
        entity_id: group.entryway
        state: 'off'
    action:
      service: homeassistant.turn_on
      entity_id: group.entryway

  - alias: bedroom off
    trigger:
      - platform: event
        event_type: toggle_bedroom_light
      - platform: event
        event_type: beroom_off
    condition:
      - condition: state
        entity_id: group.bedroom_lights
        state: 'on'
    action:
      service: homeassistant.turn_off
      entity_id: group.bedroom_lights

  - alias: bedroom on day
    trigger:
      - platform: event
        event_type: toggle_bedroom_light
      - platform: event
        event_type: bedroom_on
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: group.bedroom_lights
          state: 'off'
        - condition: time
          before: '21:00:00'
    action:
      service: homeassistant.turn_on
      entity_id: script.bedroom_lights_on_day

  - alias: bedroom on night
    trigger:
      - platform: event
        event_type: toggle_bedroom_light
      - platform: event
        event_type: bedroom_on
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: group.bedroom_lights
          state: 'off'
        - condition: time
          after: '21:00:00'
    action:
      service: homeassistant.turn_on
      entity_id: script.bedroom_lights_on_night

  - alias: kitchen cabinet lights off
    trigger:
      - platform: event
        event_type: toggle_kitchen_cabinet_lights
      - platform: event
        event_type: kitchen_off
    condition:
      - condition: state
        entity_id: switch.kitchen_cabinet_lights
        state: 'on'
    action:
      service: homeassistant.turn_off
      entity_id: switch.kitchen_cabinet_lights

  - alias: kitchen cabinet lights on
    trigger:
      - platform: event
        event_type: toggle_kitchen_cabinet_lights
      - platform: event
        event_type: kitchen_on
    condition:
      - condition: state
        entity_id: switch.kitchen_cabinet_lights
        state: 'off'
    action:
      service: homeassistant.turn_on
      entity_id: switch.kitchen_cabinet_lights

  - alias: downstairs hallway off
    trigger:
      - platform: event
        event_type: toggle_hallway_light
      - platform: event
        event_type: hallway_off
    condition:
      - condition: state
        entity_id: light.down_stairs_hallway
        state: 'on'
    action:
      service: homeassistant.turn_off
      entity_id: light.down_stairs_hallway

  - alias: hallway fan light on
    trigger:
      - platform: event
        event_type: toggle_hallway_light
      - platform: event
        event_type: hallway_on
    condition:
      condition: and
      conditions:
        - condition: state
          entity_id: switch.hallway_ceiling_fan_light
          state: 'off'
        - condition: state
          entity_id: light.down_stairs_hallway
          state: 'off'
    action:
      service: homeassistant.turn_on
      entity_id: switch.hallway_ceiling_fan_light

####################################
#########Device Tracker Automations##########
####################################

  - alias: both not home
    trigger:
      - platform: state
        entity_id: group.us
        from: 'home'
        to: 'not_home'
        for:
          minutes: 30
    action:
      - service: climate.set_temperature
        entity_id: climate.thermostat
        data:
          temperature: 73

  - alias: left home
    trigger:
      - platform: state
        entity_id: device_tracker.w1ll1am_a0001
        from: 'home'
        to: 'not_home'
      - platform: state
        entity_id: device_tracker.melinas_iphone
        from: 'home'
        to: 'not_home'
    condition:
      - condition: state
        entity_id: lock.front_door
        state: 'unlocked'
    action:
      - service: homeassistant.turn_on
        entity_id: script.lock_the_door

  - alias: billy left home
    trigger:
      - platform: state
        entity_id: device_tracker.w1ll1am_a0001
        from: 'home'
        to: 'not_home'
    condition:
      - condition: state
        entity_id: device_tracker.melinas_iphone
        state: 'not_home'
    action:
      - service: homeassistant.turn_off
        entity_id: group.wink_lights

  - alias: melina left home
    trigger:
      - platform: state
        entity_id: device_tracker.melinas_iphone
        from: 'home'
        to: 'not_home'
    condition:
      - condition: state
        entity_id: device_tracker.w1ll1am_a0001
        state: 'not_home'
    action:
      - service: homeassistant.turn_off
        entity_id: group.wink_lights

  - alias: billy at ktown
    trigger:
      - platform: state
        entity_id: device_tracker.w1ll1am_a0001
        from: 'not_home'
        to: 'Ktown'
    condition:
      - condition: numeric_state
        entity_id: sensor.egg_minder
        below: 4
    action:
      service: notify.sms_billy
      data:
        message: >
          {% if states('sensor.egg_minder') | float < 4 %}
            Get eggs! Only {{ states('sensor.egg_minder') }} eggs left.
          {%endif %}

  - alias: melina at ktown
    trigger:
      - platform: state
        entity_id: device_tracker.melinas_iphone
        from: 'not_home'
        to: 'Ktown'
    condition:
      - condition: numeric_state
        entity_id: sensor.egg_minder
        below: 4
    action:
      service: notify.ios_melinas_iphone
      data:
        message: >
          {% if states('sensor.egg_minder') | float < 4 %}
            Get eggs! Only {{ states('sensor.egg_minder') }} eggs left.
          {%endif %}

  - alias: melina is home
    trigger:
      - platform: state
        entity_id: device_tracker.melinas_iphone
        from: 'not_home'
        to: 'home'
    condition:
      condition: state
      entity_id: script.hass_start
      state: 'off'
    action:
      - service: notify.sms_billy
        data:
          message: 'Melina is home'
      - service: climate.set_temperature
        entity_id: climate.thermostat
        data:
          temperature: 71

  - alias: home on friday open garage to put trash can away
    trigger:
      - platform: state
        entity_id: device_tracker.w1ll1am_a0001
        from: 'not_home'
        to: 'home'
    condition:
        condition: and
        conditions:
          - condition: state
            entity_id: input_boolean.on_vacation
            state: 'off'
          - condition: time
            weekday:
              - fri
          - condition: time
            after: '13:00:00'
          - condition: time
            before: '18:00:00'
          - condition: state
            entity_id: cover.garage_door
            state: 'closed'
            for:
                hours: 8
    action:
      - service: cover.open_cover
        data:
          entity_id: cover.garage_door

  - alias: billy is home
    trigger:
      - platform: state
        entity_id: device_tracker.w1ll1am_a0001
        from: 'not_home'
        to: 'home'
    condition:
      condition: state
      entity_id: script.hass_start
      state: 'off'
    action:
      - service: notify.ios_melinas_iphone
        data:
          message: 'Billy is home'
      - service: climate.set_temperature
        entity_id: climate.thermostat
        data:
          temperature: 71

  - alias: turn outside lights on when someone is home
    trigger:
      - platform: state
        entity_id: device_tracker.melinas_iphone
        from: 'not_home'
        to: 'home'
      - platform: state
        entity_id: binary_sensor.melina
        from: 'off'
        to: 'on'
      - platform: state
        entity_id: device_tracker.w1ll1am_a0001
        from: 'not_home'
        to: 'home'
      - platform: state
        entity_id: binary_sensor.billy
        from: 'off'
        to: 'on'
    condition:
        condition: and
        conditions:
          - condition: template
            value_template: '{{ states.sun.sun.attributes.elevation < 2.0 }}'
    action:
        service: homeassistant.turn_on
        entity_id: group.entryway

  - alias: turn entry and living room on when someone gets home
    trigger:
      - platform: state
        entity_id: device_tracker.melinas_iphone
        from: 'not_home'
        to: 'home'
      - platform: state
        entity_id: binary_sensor.melina
        from: 'off'
        to: 'on'
      - platform: state
        entity_id: device_tracker.w1ll1am_a0001
        from: 'not_home'
        to: 'home'
      - platform: state
        entity_id: binary_sensor.billy
        from: 'off'
        to: 'on'
    condition:
        condition: and
        conditions:
          - condition: template
            value_template: '{{ states.sun.sun.attributes.elevation < 4.0 }}'
    action:
        service: homeassistant.turn_on
        entity_id: script.home_at_dusk

###################################
############Alarm Automations###########
##################################

  - alias: trigger alarm while armed home
    trigger:
      - platform: state
        entity_id: binary_sensor.front_door_opened
        from: 'off'
        to: 'on'
      - platform: state
        entity_id: binary_sensor.garage_entry_door_opened
        from: 'off'
        to: 'on'
    condition:
        - condition: state
          entity_id: alarm_control_panel.ha_alarm
          state: armed_home
    action:
        service: homeassistant.turn_on
        entity_id: script.alarm_home

  - alias: trigger alarm while armed away
    trigger:
      - platform: state
        entity_id: binary_sensor.front_door_opened
        from: 'off'
        to: 'on'
      - platform: state
        entity_id: binary_sensor.garage_entry_door_opened
        from: 'off'
        to: 'on'
      - platform: state
        entity_id: binary_sensor.living_room_motion
        from: 'off'
        to: 'on'
      - platform: state
        entity_id: binary_sensor.up_stairs_hallway_motion
        from: 'off'
        to: 'on'
      - platform: state
        entity_id: binary_sensor.down_stairs_bathroom_door_opened
        from: 'off'
        to: 'on'
      - platform: state
        entity_id: binary_sensor.office_door_opened
        from: 'off'
        to: 'on'
    condition:
        - condition: state
          entity_id: alarm_control_panel.ha_alarm
          state: armed_away
    action:
        service: homeassistant.turn_on
        entity_id: script.alarm_away

  - alias: arm alarm
    trigger:
      - platform: event
        event_type: arm_away
    action:
        service: alarm_control_panel.alarm_arm_away
        entity_id: alarm_control_panel.ha_alarm

  - alias: trigger alarm notification
    trigger:
      - platform: event
        event_type: alarm_triggered
    #condition:
    #  - condition: state
    #    entity_id: switch.siren
    #    state: 'on'
    action:
      - service: notify.sms_billy
        data:
          message: 'Intruder detected!'
      - service: notify.ios_melinas_iphone
        data:
          message: 'Intruder detected!'

  - alias: code unlock disable alarm
    trigger:
      - platform: state
        entity_id: binary_sensor.billy
        to: 'on'
      - platform: state
        entity_id: binary_sensor.melina
        to: 'on'
      - platform: state
        entity_id: binary_sensor.gdottie
        to: 'on'
      - platform: state
        entity_id: binary_sensor.parents
        to: 'on'
    action:
      - service: alarm_control_panel.alarm_disarm
        entity_id: alarm_control_panel.ha_alarm

#######################################
###########Random Event Automations###########
#######################################

  - alias: sound bar off when chromecast is off
    trigger:
      - platform: state
        entity_id: media_player.living_room
        to: 'off'
    condition:
      - condition: state
        entity_id: switch.living_room_soundbar_power
        state: 'on'
    action:
      - service: homeassistant.turn_off
        entity_id: switch.living_room_soundbar_power

  - alias: sound bar on when chromecast starts playing
    trigger:
      - platform: state
        entity_id: media_player.living_room
        to: 'playing'
    condition:
      - condition: state
        entity_id: switch.living_room_soundbar_power
        state: 'off'
    action:
      - service: homeassistant.turn_on
        entity_id: switch.living_room_soundbar_power

  - alias: check for locked lock
    trigger:
      - platform: event
        event_type: check_for_locked_lock
    condition:
        condition: or
        conditions:
          - condition: state
            entity_id: lock.front_door
            state: 'unlocked'
          - condition: state
            entity_id: binary_sensor.front_door
            state: 'on'
    action:
      - service: notify.sms_billy
        data:
          message: 'Front door failed to lock!'
      - service: notify.ios_melinas_iphone
        data:
          message: 'Front door failed to lock!'

  - alias: battery low alert
    trigger:
      - platform: template
        value_template: "{{ states.switch.siren.attributes.battery_level | float < 40 }}"
      - platform: template
        value_template: "{{ states.sensor.egg_minder.attributes.battery_level | float < 40 }}"
      - platform: template
        value_template: "{{ states.binary_sensor.front_door_opened.attributes.battery_level | float < 40 }}"
      - platform: template
        value_template: "{{ states.binary_sensor.bathroom_door_opened.attributes.battery_level | float < 40 }}"
      - platform: template
        value_template: "{{ states.binary_sensor.garage_entry_door_opened.attributes.battery_level | float < 40 }}"
      - platform: template
        value_template: "{{ states.binary_sensor.bedroom_door_opened.attributes.battery_level | float < 40 }}"
      - platform: template
        value_template: "{{ states.binary_sensor.office_door_opened.attributes.battery_level | float < 40 }}"
      - platform: template
        value_template: "{{ states.binary_sensor.laundry_door_opened.attributes.battery_level | float < 40 }}"
      - platform: template
        value_template: "{{ states.binary_sensor.dishwasher_liquid_detected.attributes.battery_level | float < 40 }}"
      - platform: template
        value_template: "{{ states.binary_sensor.living_room_motion.attributes.battery_level | float < 40 }}"
      - platform: template
        value_template: "{{ states.binary_sensor.up_stairs_hallway_motion.attributes.battery_level | float < 40 }}"
      - platform: template
        value_template: "{{ states.binary_sensor.bedroom_motion.attributes.battery_level | float < 40 }}"
    action:
      - service: notify.sms_billy
        data_template:
          message: >
            Change the {{ trigger.entity_id.split('.')[1].replace('_battery', '').replace('_',' ') }} battery
      - service: persistent_notification.create
        data_template:
          title: Low Battery
          message: >
            Change the {{ trigger.entity_id.split('.')[1].replace('_battery', '').replace('_',' ') }} battery


  - alias: locking the door stops the auto lock script
    trigger:
      - platform: state
        entity_id: lock.front_door
        from: 'unlocked'
        to: 'locked'
    condition:
      - condition: state
        entity_id: binary_sensor.front_door_opened
        state: 'off'
    action:
      service: homeassistant.turn_off
      entity_id: script.lock_the_door

  - alias: home assistant started
    trigger:
      - platform: homeassistant
        event: start
    action:
      - service: homeassistant.turn_on
        entity_id: script.hass_start
      - service: notify.sms_billy
        data:
          message: "Home Assistant started"

  - alias: notify that a device is offline
    trigger:
      - platform: state
        entity_id: binary_sensor.water_liquid_detected
        to: 'unavailable'
      - platform: state
        entity_id: lock.front_door
        to: 'unavailable'
      - platform: state
        entity_id: binary_sensor.hub
        to: 'unavailable'
      - platform: state
        entity_id: binary_sensor.front_door_opened
        to: 'unavailable'
      - platform: state
        entity_id: binary_sensor.garage_entry_door_opened
        to: 'unavailable'
      - platform: state
        entity_id: sensor.tank_uvb
        to: 'unavailable'
      - platform: state
        entity_id: sensor.tank_basking
        to: 'unavailable'
      - platform: state
        entity_id: sensor.tank_water
        to: 'unavailable'
      - platform: state
        entity_id: sensor.freezer_temperature
        to: 'unavailable'
      - platform: state
        entity_id: switch.hallway_ceiling_fan_fan
        to: 'unavailable'
      - platform: state
        entity_id: switch.hallway_ceiling_fan_light
        to: 'unavailable'
      - platform: template
        value_template: "{{ not states.sensor.garage_freezer_temperature }}"
      - platform: template
        value_template: "{{ not states.sensor.turtle_tank_water }}"
    action:
      service: notify.sms_billy
      data_template:
        message: >
          {{ trigger.entity_id.split('.')[1] }} is offline.

  - alias: turn ceiling fan light on when kitchen cabinet lights turned off
    trigger:
      - platform: state
        entity_id: switch.kitchen_cabinet_lights
        to: 'off'
      - platform: state
        entity_id: switch.kitchen_sink_light
        to: 'off'
    condition:
      - condition: time
        after: '21:40:00'
    action:
      service: homeassistant.turn_on
      entity_id: switch.hallway_ceiling_fan_light

  - alias: notify that there is a wink hub update
    trigger:
      - platform: template
        value_template: "{{ is_state_attr('binary_sensor.hub', 'update needed', True) }}"
      - platform: template
        value_template: "{{ is_state_attr('binary_sensor.wink_relay', 'update needed', True) }}"
    action:
      service: notify.sms_billy
      data_template:
        message: >
          There is a Wink hub update available!

  - alias: notify that there is a wink api issue feed
    trigger:
      - platform: event
        event_type: feedreader
    action:
      service: notify.sms_billy
      data_template:
        message: "{{ trigger.event.data.title }}"

##################################
##############iOS#################
##################################

  - alias: iOS unlock door notification
    trigger:
      platform: state
      entity_id: device_tracker.melinas_iphone
      to: 'home'
    action:
      service: notify.ios_melinas_iphone
      data:
        message: "Unlock the door?"
        data:
          push:
            category: "LOCK"


  - alias: iOS unlock door from event
    trigger:
      platform: event
      event_type: ios.notification_action_fired
      event_data:
        actionName: UNLOCK_DOOR
    action:
      service: lock.unlock
      entity_id: lock.front_door


################################
#########Camera stuff##############
###############################

  - alias: camera default
    trigger:
      platform: state
      entity_id: input_select.camera_mode
      to: 'Default'
    action:
      service: homeassistant.turn_on
      entity_id: switch.camera

  - alias: camera off
    trigger:
      platform: state
      entity_id: input_select.camera_mode
      to: 'Off'
    action:
      service: homeassistant.turn_off
      entity_id: switch.camera

  - alias: camera to door
    trigger:
      platform: state
      entity_id: input_select.camera_mode
      to: 'Door'
    action:
      service: homeassistant.turn_on
      entity_id: switch.door

  - alias: camera to dog
    trigger:
      platform: state
      entity_id: input_select.camera_mode
      to: 'Dog'
    action:
      service: homeassistant.turn_on
      entity_id: switch.dog

  - alias: camera snapshot
    trigger:
      platform: state
      entity_id: input_select.camera_mode
      to: 'Snapshot'
    action:
      service: homeassistant.turn_on
      entity_id: switch.snapshot

  - alias: camera reboot
    trigger:
      platform: state
      entity_id: input_select.camera_mode
      to: 'Reboot'
    action:
      service: homeassistant.turn_on
      entity_id: switch.reboot